@page "/admin-panel"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@using StajMulakatuygulamasi.Services
@inject NavigationManager Navigation
@inject AuthService AuthService

<PageTitle>Ana Sayfa</PageTitle>

@* --- CSS STİLLERİ --- *@
<style>
    :root {
        --primary-blue: #003366;
        --bg-light: #f0f2f5;
        --student-grad: linear-gradient(135deg, #003366, #4facfe);
        --hoca-grad: linear-gradient(135deg, #00bcd4, #1de9b6);
        --admin-grad: linear-gradient(135deg, #2d3436, #636e72);
        --cal-grad: linear-gradient(135deg, #00b894, #55efc4);
    }

    body {
        background-color: var(--bg-light);
        font-family: 'Segoe UI', Roboto, sans-serif;
    }

    .modern-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        background: #fff;
        transition: transform 0.2s;
        cursor: pointer;
        height: 100%;
    }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

    .card-header-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
    }

    .card-grad-student {
        color: #003366;
        border-left: 5px solid #003366;
    }

    .card-grad-hoca {
        color: #00bcd4;
        border-left: 5px solid #00bcd4;
    }

    .card-grad-admin {
        color: #2d3436;
        border-left: 5px solid #2d3436;
    }

    .welcome-banner {
        background: var(--student-grad);
        border-radius: 20px;
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 20px rgba(0, 51, 102, 0.3);
    }
</style>

<div class="container py-4">

    @* KARŞILAMA BANNERI *@
    <div class="welcome-banner d-flex justify-content-between align-items-center">
        <div>
            <h1 class="fw-bold mb-1">Merhaba, @(AuthService.CurrentUser?.Ad)</h1>
            <p class="mb-0 opacity-75">@userRole Paneline Hoş Geldiniz</p>
        </div>
        <button class="btn btn-light text-primary fw-bold px-4 rounded-pill" @onclick="Logout">
            <i class="bi bi-box-arrow-right me-2"></i> Çıkış
        </button>
    </div>

    @* ==================== ÖĞRENCİ İŞLEMLERİ (BURASI DÜZELDİ) ==================== *@
    @if (ShowStudentCards)
    {
        <h4 class="fw-bold text-secondary mb-3">Öğrenci İşlemleri</h4>
        <div class="row g-4">

            @* 1. KART: DERS PROGRAMI YÜKLEME (EN ÖNEMLİSİ) *@
            <div class="col-md-6">
                <div class="modern-card p-4 card-grad-student" @onclick='() => NavigateTo("/ogrenci-program")'>
                    <i class="bi bi-calendar-plus card-header-icon d-block"></i>
                    <h4 class="fw-bold">Ders Programı Yükle</h4>
                    <p class="text-muted">Mülakat saatinizin derslerinizle çakışmaması için güncel ders programınızı buradan sisteme girin.</p>
                    <button class="btn btn-outline-primary rounded-pill w-100 mt-2">Program Yükle <i class="bi bi-arrow-right"></i></button>
                </div>
            </div>

            @* 2. KART: SONUÇ GÖRME *@
            <div class="col-md-6">
                <div class="modern-card p-4 card-grad-student" @onclick='() => NavigateTo("/ogrenci-panel")'>
                    <i class="bi bi-calendar-check card-header-icon d-block"></i>
                    <h4 class="fw-bold">Mülakat Sonucum</h4>
                    <p class="text-muted">Size atanan mülakat tarihini, saatini ve görüşeceğiniz hocayı buradan görüntüleyin.</p>
                    <button class="btn btn-outline-primary rounded-pill w-100 mt-2">Sonucu Gör <i class="bi bi-arrow-right"></i></button>
                </div>
            </div>
        </div>
    }

    @* ==================== ADMIN İŞLEMLERİ (SADELEŞTİRİLDİ) ==================== *@
    @if (ShowAdminCards)
    {
        <h4 class="fw-bold text-secondary mb-3">Yönetici İşlemleri</h4>
        <div class="row">
            <div class="col-12">
                <div class="modern-card p-5 card-grad-admin text-center d-flex flex-column align-items-center justify-content-center"
                     @onclick='() => NavigateTo("/mulakat-planlama")'>

                    <i class="bi bi-shield-lock-fill display-4 mb-3"></i>
                    <h3 class="fw-bold">Yönetim Paneli</h3>
                    <p class="text-muted w-75">Mülakat planlama algoritmasını çalıştırmak ve sistem ayarlarını yapmak için yönetim paneline gidin.</p>

                    <button class="btn btn-dark btn-lg px-5 rounded-pill mt-3">
                        Panele Git <i class="bi bi-arrow-right-circle ms-2"></i>
                    </button>
                </div>
            </div>
        </div>
    }

    @* ==================== AKADEMİSYEN İŞLEMLERİ ==================== *@
    @if (ShowAcademicCards)
    {
        <h4 class="fw-bold text-secondary mb-3">Akademisyen İşlemleri</h4>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="modern-card p-4 card-grad-hoca" @onclick='() => NavigateTo("/akademisyen-panel")'>
                    <i class="bi bi-list-task card-header-icon d-block"></i>
                    <h4 class="fw-bold">Mülakat Listem</h4>
                    <p class="text-muted">Size atanan öğrencileri listeleyin ve Excel çıktısı alın.</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="modern-card p-4 card-grad-hoca" @onclick='() => NavigateTo("/hoca-musaitlik")'>
                    <i class="bi bi-clock-history card-header-icon d-block"></i>
                    <h4 class="fw-bold">Müsaitlik Bildir</h4>
                    <p class="text-muted">Hangi gün ve saatlerde uygun olduğunuzu sisteme girin.</p>
                </div>
            </div>
        </div>
    }

    @* GENEL TAKVİM (HERKES İÇİN ALTTA) *@
    <div class="row mt-5">
        <div class="col-12">
            <div class="alert alert-light border shadow-sm d-flex align-items-center justify-content-between p-4" role="alert">
                <div class="d-flex align-items-center">
                    <i class="bi bi-calendar3 fs-2 text-success me-3"></i>
                    <div>
                        <h5 class="fw-bold mb-0">Genel Mülakat Takvimi</h5>
                        <small class="text-muted">Onaylanmış tüm mülakatları genel listede görün.</small>
                    </div>
                </div>
                <button class="btn btn-success rounded-pill" @onclick='() => NavigateTo("/mulakat-takvimi")'>Takvimi Aç</button>
            </div>
        </div>
    </div>

</div>

@code {
    private string? userRole;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (AuthService.CurrentUser == null || AuthService.CurrentUser.Role == null)
            {
                Navigation.NavigateTo("/", forceLoad: true);
            }
            else
            {
                userRole = AuthService.CurrentUser.Role.RoleName;
                StateHasChanged();
            }
        }
    }

    private bool ShowStudentCards => userRole == "Ogrenci";
    private bool ShowAcademicCards => userRole == "OgretimGorevlisi";
    private bool ShowAdminCards => userRole == "Admin";

    private void NavigateTo(string url)
    {
        Navigation.NavigateTo(url);
    }

    private void Logout()
    {
        AuthService.Logout();
        Navigation.NavigateTo("/", forceLoad: true);
    }
}